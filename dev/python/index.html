
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../deployment/">
      
      
        <link rel="next" href="../streaming/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>PySpark - Spark studies</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spark-programming-with-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Spark studies" class="md-header__button md-logo" aria-label="Spark studies" data-md-component="logo">
      
  <img src="../../images/apache_spark_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spark studies
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PySpark
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jbcodeforce/spark-studies" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spark studies" class="md-nav__button md-logo" aria-label="Spark studies" data-md-component="logo">
      
  <img src="../../images/apache_spark_logo.png" alt="logo">

    </a>
    Spark studies
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jbcodeforce/spark-studies" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Develop with Spark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Develop with Spark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    PySpark
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    PySpark
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#major-constructs" class="md-nav__link">
    <span class="md-ellipsis">
      Major constructs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-with-pyspark" class="md-nav__link">
    <span class="md-ellipsis">
      Coding with PySpark
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding with PySpark">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-python-program" class="md-nav__link">
    <span class="md-ellipsis">
      First python program
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-the-lowest-rated-movie" class="md-nav__link">
    <span class="md-ellipsis">
      Computing the lowest rated movie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assessing-similar-movies" class="md-nav__link">
    <span class="md-ellipsis">
      Assessing similar movies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movie-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Movie recommendations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deeper-dive" class="md-nav__link">
    <span class="md-ellipsis">
      Deeper dive
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../streaming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streaming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scala_summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scala summary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://jbcodeforce.github.io/techno/databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compendium/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compendium
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://jbcodeforce.github.io" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Return to main
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#major-constructs" class="md-nav__link">
    <span class="md-ellipsis">
      Major constructs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-with-pyspark" class="md-nav__link">
    <span class="md-ellipsis">
      Coding with PySpark
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding with PySpark">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-python-program" class="md-nav__link">
    <span class="md-ellipsis">
      First python program
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computing-the-lowest-rated-movie" class="md-nav__link">
    <span class="md-ellipsis">
      Computing the lowest rated movie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assessing-similar-movies" class="md-nav__link">
    <span class="md-ellipsis">
      Assessing similar movies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movie-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Movie recommendations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deeper-dive" class="md-nav__link">
    <span class="md-ellipsis">
      Deeper dive
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="spark-programming-with-python">Spark programming with Python<a class="headerlink" href="#spark-programming-with-python" title="Permanent link">&para;</a></h1>
<p>PySpark is the Python API to  perform real-time, large-scale data processing in a distributed environment using Python.</p>
<p>See <a href="https://spark.apache.org/docs/latest/api/python/index.html">the product documentation to learn how to use pySpark</a>.</p>
<p>The advantages:</p>
<ul>
<li>Write Spark app in Python.</li>
<li>Use interactive analysis of data in distributed environment.</li>
<li>Pandas workload to any size by running it distributed across multiple nodes.</li>
</ul>
<h2 id="major-constructs">Major constructs<a class="headerlink" href="#major-constructs" title="Permanent link">&para;</a></h2>
<ul>
<li>PySpark DataFrames are implemented on top of RDD.</li>
<li>
<p>PySpark applications start with initializing SparkSession</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</code></pre></div>
</li>
<li>
<p>PySpark DataFrame can be created via <code>pyspark.sql.SparkSession.createDataFrame</code> typically by passing a list of lists, tuples, dictionaries and pyspark.sql.Rows, a pandas DataFrame and an RDD. It supports discovering the schema from the data, or explicit schema definition:</p>
<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="s1">&#39;string1&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="s1">&#39;string2&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="s1">&#39;string3&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">],</span> <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;a long, b double, c string, d date, e timestamp&#39;</span><span class="p">)</span>
<span class="c1"># show a summary of a data frame</span>
<span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</li>
</ul>
<h2 id="coding-with-pyspark">Coding with PySpark<a class="headerlink" href="#coding-with-pyspark" title="Permanent link">&para;</a></h2>
<h3 id="first-python-program">First python program<a class="headerlink" href="#first-python-program" title="Permanent link">&para;</a></h3>
<p>See FirstSparkProgram.py code in <a href="https://github.com/jbcodeforce/spark-studies/tree/master/src/samples">src/samples</a> folder.</p>
<p>All Spark python program need a main function and then can use SparkContext or sql.SparkSession</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sparkConfiguration</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span><span class="n">setAppName</span><span class="p">(</span><span class="s2">&quot;App name&quot;</span><span class="p">)</span>
    <span class="n">sparkSession</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="n">conf</span> <span class="o">=</span> <span class="n">sparkConfiguration</span><span class="p">)</span>
    <span class="c1"># .. do a lot of things</span>
    <span class="n">sparkSession</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div>
<p>The main function build a spark session, loads the data in a RDD and performs transformation or actions.</p>
<div class="highlight"><pre><span></span><code>    <span class="n">sparkConfiguration</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span><span class="n">setAppName</span><span class="p">(</span><span class="s2">&quot;Get POST requests&quot;</span><span class="p">)</span>
    <span class="n">sparkSession</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="n">conf</span> <span class="o">=</span> <span class="n">sparkConfiguration</span><span class="p">)</span>
    <span class="c1"># load text file in RDD</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">sparkSession</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s1">&#39;../data/access_log.txt&#39;</span><span class="p">)</span>
    <span class="c1"># get lines with POST trace</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</code></pre></div>
<ul>
<li>To run it, be sure docker compose has started a master node and at least one worker node. </li>
<li>Verify the Master console: <a href="http://localhost:8085/">http://localhost:8085/</a></li>
<li>
<p>Run the sample python program: To be able to run program as job on Spark cluster, we need to connect to the cluster and use <code>spark-submit</code> command. </p>
<p>For that we are using another container instance, with the source code mounted to <code>/home</code>:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>--network<span class="w"> </span>spark-network<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/home<span class="w"> </span>jbcodeforce/spark<span class="w"> </span>bash
</code></pre></div>
<p>In the shell within this container runs:</p>
<div class="highlight"><pre><span></span><code>bash-5.2#<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/src
bash-5.2#<span class="w"> </span>spark-submit<span class="w"> </span>samples/FirstSparkProgram.py
</code></pre></div>
</li>
</ul>
<p>The traces illustrate the start of the Executor, the creation of a SparkContext, the scheduling of a job,  the creation of a Python Runner, the DAG and the task executions.</p>
<h3 id="computing-the-lowest-rated-movie">Computing the lowest rated movie<a class="headerlink" href="#computing-the-lowest-rated-movie" title="Permanent link">&para;</a></h3>
<p>The approach is to read the rating file and map each line to a SQL Row(movieID , rating) then transform it in data frame. From the DataFram it is easy to compute average rating for each movieID, and counts the number of time the movie is rated, joins the two data frames and finally pulls the top 10 results:</p>
<p>See the code in <a href="https://github.com/jbcodeforce/spark-studies/blob/master/src/samples/LowestRatedMovieDataFrame.py">LowestRatedMovieDataFrame.py</a></p>
<div class="highlight"><pre><span></span><code>bash-4.4#<span class="w"> </span>spark-submit<span class="w"> </span>samples/LowestRatedMovieDataFrame.py

Amityville:<span class="w"> </span>Dollhouse<span class="w"> </span><span class="o">(</span><span class="m">1996</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
Somebody<span class="w"> </span>to<span class="w"> </span>Love<span class="w"> </span><span class="o">(</span><span class="m">1994</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
Every<span class="w"> </span>Other<span class="w"> </span>Weekend<span class="w"> </span><span class="o">(</span><span class="m">1990</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
Homage<span class="w"> </span><span class="o">(</span><span class="m">1995</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
<span class="m">3</span><span class="w"> </span>Ninjas:<span class="w"> </span>High<span class="w"> </span>Noon<span class="w"> </span>At<span class="w"> </span>Mega<span class="w"> </span>Mountain<span class="w"> </span><span class="o">(</span><span class="m">1998</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
Bird<span class="w"> </span>of<span class="w"> </span>Prey<span class="w"> </span><span class="o">(</span><span class="m">1996</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
Power<span class="w"> </span><span class="m">98</span><span class="w"> </span><span class="o">(</span><span class="m">1995</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
Beyond<span class="w"> </span>Bedlam<span class="w"> </span><span class="o">(</span><span class="m">1993</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
Falling<span class="w"> </span><span class="k">in</span><span class="w"> </span>Love<span class="w"> </span>Again<span class="w"> </span><span class="o">(</span><span class="m">1980</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
T-Men<span class="w"> </span><span class="o">(</span><span class="m">1947</span><span class="o">)</span><span class="w"> </span><span class="m">1</span>.0
</code></pre></div>
<h3 id="assessing-similar-movies">Assessing similar movies<a class="headerlink" href="#assessing-similar-movies" title="Permanent link">&para;</a></h3>
<p>This example is using Pandas with Spark to merge two files: movie rating and movie data. Spark context has the <code>read_text</code> function from different files into a single RDD. Then the code transforms this RDD in data frame, and uses pivot table.</p>
<h3 id="movie-recommendations">Movie recommendations<a class="headerlink" href="#movie-recommendations" title="Permanent link">&para;</a></h3>
<p>It reads the rating file and maps each line to a SQL Row(userID , movieID , rating) then transforms it in data frame so it can apply ML recommendation using the <a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.recommendation.ALS.html">Alternating Least Squares</a> API on the dataframe. Once the model is fitted, takes the movies with at least 100 ratings, builds a test dataframe with the movie evaludated by user 0. From those movies, uses the model to do recommendations, finally gets the top 20 movies with the highest predicted rating for this user.</p>
<p>See the code in <a href="https://github.com/jbcodeforce/spark-studies/blob/master/src/samples/MovieRecommendationsALS.py">MovieRecommendationsALS.py</a></p>
<div class="highlight"><pre><span></span><code>bash-5.2#<span class="w"> </span>spark-submit<span class="w"> </span>samples/MovieRecommendationsALS.py

Clerks<span class="w"> </span><span class="o">(</span><span class="m">1994</span><span class="o">)</span><span class="w"> </span><span class="m">5</span>.125946044921875
Die<span class="w"> </span>Hard<span class="w"> </span><span class="o">(</span><span class="m">1988</span><span class="o">)</span><span class="w"> </span><span class="m">5</span>.088437557220459
Star<span class="w"> </span>Wars<span class="w"> </span><span class="o">(</span><span class="m">1977</span><span class="o">)</span><span class="w"> </span><span class="m">5</span>.009941101074219
Army<span class="w"> </span>of<span class="w"> </span>Darkness<span class="w"> </span><span class="o">(</span><span class="m">1993</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.961264610290527
Empire<span class="w"> </span>Strikes<span class="w"> </span>Back,<span class="w"> </span>The<span class="w"> </span><span class="o">(</span><span class="m">1980</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.9492716789245605
Alien<span class="w"> </span><span class="o">(</span><span class="m">1979</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.911722183227539
Frighteners,<span class="w"> </span>The<span class="w"> </span><span class="o">(</span><span class="m">1996</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.8579559326171875
Reservoir<span class="w"> </span>Dogs<span class="w"> </span><span class="o">(</span><span class="m">1992</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.808855056762695
Raiders<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>Lost<span class="w"> </span>Ark<span class="w"> </span><span class="o">(</span><span class="m">1981</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.786505222320557
Star<span class="w"> </span>Trek:<span class="w"> </span>The<span class="w"> </span>Wrath<span class="w"> </span>of<span class="w"> </span>Khan<span class="w"> </span><span class="o">(</span><span class="m">1982</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.760307312011719
Terminator,<span class="w"> </span>The<span class="w"> </span><span class="o">(</span><span class="m">1984</span><span class="o">)</span><span class="w"> </span><span class="m">4</span>.759642124176025
...
</code></pre></div>
<h2 id="deeper-dive">Deeper dive<a class="headerlink" href="#deeper-dive" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.RDD.html">RDD pyspark API</a></li>
<li><a href="https://github.com/spark-examples/pyspark-examples">PySpark RDD, Dataframe and SQL examples from spark-examples github</a> also explained in <a href="https://sparkbyexamples.com/pyspark-tutorial/">pyspark-tutorial.</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
    
  </body>
</html>